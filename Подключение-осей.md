##  Подключение датчиков и назначение контактов контроллера:

![](https://github.com/FreeJoy-Team/FreeJoyConfigurator/blob/master/images/rus_guide/A1.jpg)
 
**Внимание: Питание датчика Холла TLE5010 осуществляется от контакта 5В при этом работа датчике не гарантируется и мы рекомендуем вам использовать TLE5011!** (Питание прочих датчиков (в том числе TLE5011, осуществляется от 3,3В).

Чертеж платы TLE 5011 для Sprint Layout можно взять [здесь](https://github.com/FreeJoy-Team/FreeJoyConfigurator/blob/master/third_party/)
* SPI_SCK – Общий для всех TLE5011 и всех цепочек сдвиговых регистров;
* TLE501x_DATA – общий для всех TLE5011;
* TLE501x_GEN – общий для всех TLE5011;
* TLE501x_CS – индивидуальный для каждого TLE5011.

Величина переменного сопротивления для аналоговой оси – 10КОм.

## Назначение логических осей:

![](https://github.com/FreeJoy-Team/FreeJoyConfigurator/blob/master/images/rus_guide/A1.jpg)
 
Как и в случае с кнопками мы должны назначить необходимым логическим осям физические оси.

Название аналоговой оси, выводимой на компьютер обозначено в левом верхнем углу поля этой оси. Всего может быть 8 осей: X, Y, Z, Rx, Ry, Rz, Slider1, Slider2. Вы можете назначить любую физическую ось на любую логическую в поле Axis source 1. При этом для аналоговых физических осей обозначением будет являться сигнальный контакт (средний контакт переменного резистора, в этом случае А7), а для цифровых – контакт выбора чипа (SC контакт микросхемы TLE5011, в этом случае А15). У неиспользуемых в проекте осей необходимо снять галку Output enabled.

Красная шкала «Out» показывает какие значения логической оси выдаются операционной системе, зеленая шкала «Raw» показывает какие значения физической оси контроллер принимает от датчика.
## Калибровка осей.
После назначения осей оси необходимо откалибровать. (Т.е. сделать так, чтобы полный ход физической оси соответствовал полному ходу логической оси.) Калибровать оси FreeJoy средствами Windows крайне не рекомендуется!
### Калибровка оси без центра.
1. Нажать кнопку Start calibration.
1. Подвигать ось из одного крайнего положения в другое.
1. Нажать кнопку Stop calibration.
1. Снять галочку с чекбокса «Center».
1. Записать результаты калибровки в контролер.
### Калибровка оси с центром.
1. Нажать кнопку Start calibration.
1. Подвигать ось из одного крайнего положения в другое и оставить в центральном положении.
1. Нажать кнопку Stop calibration.
1. Записать результаты калибровки в контролер.
### Калибровка цифрового датчика TLE5011 со смещением диапазона.
В случае если вы установили цифровой датчик и при движении его из одного крайнего положения в другое значения физ. Оси проходят через ноль (т.е. растут до максимального значения сбрасываются на ноль и продолжают расти от нуля), необходимо сдвинуть диапазон показаний датчика:
1. В поле логической оси поставить галку «Offset».
1. В поле «Offset» установить 180.
1. Записать настройки с контроллер.
1. Проверить перемещением оси, что теперь ось не проходит через ноль.
1. При необходимости, если ось все так же проходит через ноль: скорректировать значения поля «Offset», повторить п.п. 2-5.
1. Калибровать ось как описано выше для осей с центром или без центра.
## Дополнительная настройка осей:
В поле каждой логической оси доступны следующие настройки:
* Inverted – инвертирует логическую ось (ось будет регулироваться в противоположном направлении);
* Resolution – разрешение оси в битах. При том число отсчетов на диапазон движения оси будет равен 2 в степени, указанной в поле Resolution. Для аналоговых осей, как правило, имеют смысл значения не более 12. Для цифровых датчиков можно увеличить разрешение до 16 (65536 отсчетов).
* Dinamic Deadband – установка для оси динамической мертвой зоны. Величина динамической мертвой зоны указывается в поле «Deadband» ниже. При этом изменения значения оси н величину не превышающую значения поля «Deadband» учитываться не будут. Для устранения дрожжания оси меет смысл постепенно увеличивать значения динамической метрвой зоны (не забывая при каждом изменении значения записывать конфигурацию в контроллер) до тех пор, пока значения логической оси не перестанут изменяться самопроизвольно при отсутствии движения физической оси. При снятой галке “Dynamic deadband” заданный размер мертвой зоны применяется к центральной мертвой зоне.
* Filter – ползунок позволяющий задать фильтр оси. Может быть: Off, Level1… Level 7. При этом, чем выше значение фильтра, тем больше будет отставание изменения значений логической оси за физической осью, поэтому для ответственных осей не рекомендуется выставлять фильтр в значение выше Level 3.
* На вкладке Axis Curves можно задать закономерность изменения значений каждой логической оси от физической отличную от линейной. Можно воспользоваться предуставленными кривыми (линейная зависимость (по умолчанию), экспоненциальная, обратно экспоненциальная, произвольная кривые) либо отредактировать любую из этих кривых двигая движки, соответствующие каждой точке вверх/вниз.
## Функции сложения осей:
В поле Function можно задать способ сложения/вычитания двух осей.

При этом первым источником является физическая ось (указанная в поле Axis source 1 (далее в формулах AS1) вторая – логическая (указанная в поле Axis source 2 (далее в формулах AS2).
Доступны следующие функции:
* Plus_Absolute = (AS1+AS2)/2. Т.е. минимум результирующей оси достигается при минимуме обеих осей-источников, Максимум – при максимуме.
* Plus_Relative = (AS1+AS2)+32767 Т.е. минимум результирующей оси достигается при минимуме обеих осей-источников, Максимум – при максимуме одной из осей-источника.
* Minus_Absolute = (AS1-AS2)/2 Т.е. результирующая ось находится в центре при минимуме обеих осей-источников, При максимуме одной оси-источника, результирующая ось отклоняется к максимуму, при максимуме второй – к минимуму.
* Minus_ Relative = (AS1-AS2)-32767 вычитание со смещением влево на половину оси.

## Преобразование движения осей в нажатия кнопок.
Для назначения того, что бы при определенном положении оси генерировалось нажатие кнопки служит вкладка Axis to Buttons.

![](https://github.com/FreeJoy-Team/FreeJoyConfigurator/blob/master/images/rus_guide/A3.jpg)
 
* Слева чекбокс с порядковым номером оси. Установка в нем галочки включает функцию Оси в кнопки для указанной оси.
* Справа в поле можно установить количество интервалов для которых будут назначены кнопки.
* В середине графически изображены шкалы осей, слева минимальное значение оси, справа – максимальное. Движки позволяют задать пределы в которых будет транслироваться нажатие кнопки. (Т.е. между 1-м и 2-м движками – первая кнопка, между 2-м и 3-м – вторая и т.д.).
После этой настройки в поле Phisical Buttons закладки Button Config будет добавлено соответствующее количество физических кнопок (для этого примера 4 шт.), которые можно назначить любым логическим кнопкам:

![](https://github.com/FreeJoy-Team/FreeJoyConfigurator/blob/master/images/rus_guide/A4.jpg)
 
При такой настройке лог. Кнопка 1 будет срабатывать в самом начале оси (заглушить двигатель), лог. кнопка 2 чуть позже (малый газ), и лог. Кнопка 4 в самом конце (форсаж). При этом показания оси так же будут транслироваться в операционную систему.

## Преобразование нажатия кнопок в движение осей.

![](https://github.com/FreeJoy-Team/FreeJoyConfigurator/blob/master/images/rus_guide/A5.jpg)
 
1. Axis source оставляем Buttons.
1. В поле Button↓ выбираем логическую кнопку, которая будет уменьшать значение оси. Button↑ - логическую кнопку, которая будет увеличивать значение оси. Center – будет ставить ось в середину (Здесь на эту функцию назначена кнопка энкодера). Step – шаг в процентах с которым будет изменяться значение оси на каждый щелчок энкодера или нажатие кнопки.

## Проверка работы осей
Окончательно работу осей можно проверить: (для Windows 10) «Пуск», «Параметры», «Устройства», «Устройства и принтеры» правой кнопкой на устройство, «Параметры игровых устройств управления», выбрать устройство, «Свойства». Либо программой VKB_JoyTester, можно взять [здесь](https://github.com/FreeJoy-Team/FreeJoyConfigurator/blob/master/third_party/).

